<!doctype html>
<html lang="en">

<head>
  <meta charset="utf-8">
  <title>Slideshow</title>
  <link rel="icon" href="favicon.ico" type="image/x-icon" />  <script src="jquery-1.12.4.js"></script>
  <script src="jquery-ui.js"></script>
  <script src="http://localhost:8000/socket.io/socket.io.js"></script>
  <script>
    $(document).ready(function() {
      var socket = io.connect("http://localhost:8000");
      var defaultDelay = 3; //sec
      var nextEq = 0;
      var slideTimer;
      var activeId = "";
      var zoomCount = 0;
      var setTimeoutFunc1;
      var zoomCount = 0;
      var viewPic = 1; //false
      var mouseOver = 1; //false
      var timerInc;
      var timerInc2;
      var timerDec;
      var timerDec2;
      var mouseD = 1;
      $("#sortable").sortable();
      $("#sortable .newDiv").draggable();

      $("#sortable").disableSelection();

      socket.on("slideData", function(data) {
        uri_uriKey = data.dataImg;
        uri_dir = data.dir;
        defaultDelay = data.delay;

        function newDivFunction(item, index) {
          var newImgPath = item.uri;
          var newDiv = document.createElement("div");
          newDiv.setAttribute("style", "background-image: url(" + data.dir + newImgPath + ")");
          newDiv.setAttribute("id", item.uriKey);
          newDiv.setAttribute("data-delay", defaultDelay);
          newDiv.className = "newDiv ui-widget-content";
          document.getElementById("sortable").appendChild(newDiv);
        } //newDivFunction
        data.dataImg.forEach(newDivFunction);

        function toggleFullScreen() {
          if (!document.fullscreenElement && !document.mozFullScreenElement && !document.webkitFullscreenElement && !document.msFullscreenElement) {
            $("#full").attr("src", "icons/icons-fullscreen-exit.png");
            $("#full").attr("title", "fullscreen exit");
            if (document.documentElement.requestFullscreen) {
              document.documentElement.requestFullscreen();
            } else if (document.documentElement.msRequestFullscreen) {
              document.documentElement.msRequestFullscreen();
            } else if (document.documentElement.mozRequestFullScreen) {
              document.documentElement.mozRequestFullScreen();
            } else if (document.documentElement.webkitRequestFullscreen) {
              document.documentElement.webkitRequestFullscreen(Element.ALLOW_KEYBOARD_INPUT);
            }
          } else {
            $("#full").attr("src", "icons/icons-fullscreen.png");
            $("#full").attr("title", "fullscreen");
            if (document.exitFullscreen) {
              document.exitFullscreen();
            } else if (document.msExitFullscreen) {
              document.msExitFullscreen();
            } else if (document.mozCancelFullScreen) {
              document.mozCancelFullScreen();
            } else if (document.webkitExitFullscreen) {
              document.webkitExitFullscreen();
            }
          }
        }

        function slideShow(nextEq) {
          slideTimer = setTimeout(function() {
            defaultDelay = $("#sortable .newDiv").eq(nextEq).attr("data-delay");
            if (nextEq > $("#sortable div").last().index()) {
              nextEq = -1;
            }
            //          nextEq = nextE;
            $("#sortable .newDiv").fadeTo(250, 0);
            $("#sortable .newDiv").hide();
            $("#sortable .newDiv").eq(nextEq).fadeTo(500, 1.0);
            nextEq += 1;
            slideShow(nextEq);
          }, defaultDelay * 1000);
        }; //slideShow();        

        $(document).on("click", "#play", function() {
          $("#sortable .newDiv").hide();
          $(".menuPic").hide();
          $("#sortable .newDiv").css({
            "width": "100%",
            "height": "100vh",
            "position": "absolute",
            "left": "0px",
            "top": "0px",
            "margin": "0"
          });
          jQuery("#play").attr("src", "icons/icons-pause.png");
          jQuery("#play").attr("id", "pause");
          defaultDelay = $("#sortable .newDiv").eq(nextEq).attr("data-delay");
          defaultDelay = 0;
          slideShow(nextEq);
        }); //play

        $(document).on("click", "#pause", function() {
          clearTimeout(slideTimer);
          defaultDelay = 0;
          viewPic = 0; //true
          zoomCount = 0;
          jQuery(this).attr("id", "resume");
          jQuery(this).attr("src", "icons/icons-play.png");
          $(".menuPic").show();
          activeId = $("#sortable .newDiv").eq(nextEq).attr("id");
        }); //pause

        $(document).on("click", "#resume", function() {
          $(".menuPic").hide();
          jQuery(this).attr("id", "pause");
          jQuery(this).attr("src", "icons/icons-pause.png");
          $("#sortable .newDiv").css({
            "width": "100%",
            "height": "100vh",
            "position": "absolute",
            "left": "0px",
            "top": "0px",
            "margin": "0"
          });
          defaultDelay = 0;
          slideShow(nextEq);
        });

        $(document).on("click", "#stop", function() {
          viewPic = 1; //false
          clearTimeout(slideTimer);
          defaultDelay = 0;
          $(".menuPic").hide();
          nextEq = 0;
          $("#sortable .newDiv").css({
            "width": "200px",
            "height": "200px",
            "position": "relative",
            "left": "0px",
            "top": "0px",
            "margin": "1",
            "display": "inline"
          });
          jQuery(".playClass").attr("id", "play");
          jQuery(".playClass").attr("src", "icons/icons-play.png");
          $("#sortable .newDiv").fadeTo(250, 0);
          $("#sortable .newDiv").fadeTo(500, 1.0);
        }); //stop

        $(document).on("click", ".newDiv", function() {
          nextEq = $(this).index();
          viewPic = 0;
          zoomCount = 0;
          if ($(this).is(":first-child")) {
            $("#prevPic").css("opacity", "0.5");
          } else {
            $("#prevPic").css("opacity", "1");
          }
          if ($(this).is(":last-child")) {
            $("#nextPic").css("opacity", "0.5");
          } else {
            $("#nextPic").css("opacity", "1");
          }
          $("#sortable").children().hide();
          $("#sortable .newDiv").eq(nextEq).css({
            "width": "100%",
            "height": "100vh",
            "position": "absolute",
            "left": "0px",
            "top": "0px",
            "margin": "0"
          });
          activeId = $("#sortable .newDiv").eq(nextEq).attr("id");
          setDelay = $(this).attr("data-delay");
          $("#delayCountTxt").val(setDelay);
          $("#sortable .newDiv").fadeTo(250, 0);
          $("#sortable .newDiv").hide();
          $("#" + activeId).fadeTo(500, 1.0);
          $(".menuPic").show();
          clearTimeout(slideTimer);
          defaultDelay = 0;
          jQuery(".playClass").attr("id", "resume");
          jQuery(".playClass").attr("src", "icons/icons-play.png");
        }); //newDiv

        $(document).on("click", "#zoomIn", function() {
          if (zoomCount < 7) {
            zoomCount += 1;
            if (zoomCount == 0) {
              $("#" + activeId).trigger("click");
            } else {
              var divWidth = $("#" + activeId).width();
              var divHeight = $("#" + activeId).height();
              $("#" + activeId).css({
                "width": divWidth * 1.25,
                "height": divHeight * 1.25
              });
              if (($("#" + activeId).width()) < ($(window).width())) {
                $("#" + activeId).css({
                  "margin-left": (($(window).width()) - ($("#" + activeId).width())) / 2
                });
              }
              if (($("#" + activeId).height()) < ($(window).height())) {
                $("#" + activeId).css({
                  "margin-top": (($(window).height()) - ($("#" + activeId).height())) / 2
                });
              }
            }
            if (($("#" + activeId).width()) > ($(window).width())) {
              var scrollCentreWidth = ($("#" + activeId).width() - $(window).width()) / 2;
              $("html, body").animate({
                scrollLeft: scrollCentreWidth + "px"
              }, 1);
            }
            if (($("#" + activeId).height()) > ($(window).height())) {
              var scrollCentre = ($("#" + activeId).height() - $(window).height()) / 2;
              $("html, body").animate({
                scrollTop: scrollCentre + "px"
              }, 1);
            }
          }
        });

        $(document).on("click", "#zoomNormal", function() {
          $("#" + activeId).trigger("click");
          zoomCount = 0;
        });

        $(document).on("click", "#zoomOut", function() {
          if (zoomCount > -7) {
            zoomCount += -1;
            if (zoomCount == 0) {
              $("#" + activeId).trigger("click");
            } else {
              var divWidth = $("#" + activeId).width();
              var divHeight = $("#" + activeId).height();
              $("#" + activeId).css({
                "width": divWidth / 1.25,
                "height": divHeight / 1.25
              });
              if (($("#" + activeId).width()) < ($(window).width())) {
                $("#" + activeId).css({
                  "margin-left": (($(window).width()) - ($("#" + activeId).width())) / 2
                });
              }
              if (($("#" + activeId).height()) < ($(window).height())) {
                $("#" + activeId).css({
                  "margin-top": (($(window).height()) - ($("#" + activeId).height())) / 2
                });
              }
            }
            if (($("#" + activeId).width()) > ($(window).width())) {
              var scrollCentreWidth = ($("#" + activeId).width() - $(window).width()) / 2;
              $("html, body").animate({
                scrollLeft: scrollCentreWidth + "px"
              }, 1);
            }
            if (($("#" + activeId).height()) > ($(window).height())) {
              var scrollCentre = ($("#" + activeId).height() - $(window).height()) / 2;
              $("html, body").animate({
                scrollTop: scrollCentre + "px"
              }, 1);
            }
          }
        });

        $(document).on("click", "#nextPic", function() {
          $("#" + activeId).next().trigger("click");
        });

        $(document).on("click", "#prevPic", function() {
          $("#" + activeId).prev().trigger("click");
        });

        $(document).on("mousemove", function() {
          clearTimeout(setTimeoutFunc1);
          $("#menu").fadeIn(500);
          if (mouseOver == 1) {
            setTimeoutFunc1 = setTimeout(function() {
              $("#menu").hide();
            }, 5000);
          }
        });

        $("#menu").on("mouseover", function() {
          mouseOver = 0;
          clearTimeout(setTimeoutFunc1);
          $("#menu").fadeIn(500);
        });
        $("#menu").on("mouseout", function() {
          mouseOver = 1;
        });

        $(document).on("click", "#full", function() {
          toggleFullScreen();
        }); //full

        $(document).on("mouseup", "#addCount", function() {
          clearInterval(timerInc);
          mouseD = 1;
        });
        $(document).on("mouseup", "#minusCount", function() {
          clearInterval(timerDec);
          mouseD = 1;
        });

        $(document).on("change paste keyup mouseup", "#delayCountTxt, #minusCount, #addCount", function() {
          $("#sortable .newDiv").eq(nextEq).attr("data-delay", ($('#delayCountTxt').val()));
        });

        $(document).on("mousedown", "#addCount", function() {
          mouseD = 0;
          //increment();
          clearInterval(timerInc);
          document.querySelector("#delayCountTxt").stepUp();
          timerInc = setInterval(function() {
            clearInterval(timerInc2);
            timerInc2 = setInterval(function() {
              if (mouseD == 0) {
                document.querySelector("#delayCountTxt").stepUp();
              } else {
                clearInterval(timerInc2);
              }
            }, 100);
          }, 250);
        });

        $(document).on("mousedown", "#minusCount", function() {
          mouseD = 0;
          //increment();
          clearInterval(timerDec);
          document.querySelector("#delayCountTxt").stepDown();
          timerDec = setInterval(function() {
            clearInterval(timerDec2);
            timerDec2 = setInterval(function() {
              if (mouseD == 0) {
                document.querySelector("#delayCountTxt").stepDown();
              } else {
                clearInterval(timerDec2);
              }
            }, 100);
          }, 250);
        });
      }); //on
    }); //ready
  </script>

  <style>
    html,
    body {
      margin: 0;
      background-color: #000;
      font-size: 16px;
      font-family: Arial, Helvetica, sans-serif;
      color: #39f;
    }

    body::-webkit-scrollbar {
      width: 20px;
      height: 20px;
      background: rgba(0, 0, 0, 0.6);
      color: #3399ff;
      border: 1px solid #3399ff;
      border-radius: 10px;
    }

    body::-webkit-scrollbar-thumb {
      background: #3399ff;
      border-radius: 10px;
      color: #3399ff;
      opacity: 0.5;
      min-height: 30px;
    }

    ::-webkit-scrollbar-thumb:active {
      background: #3399ff;
      border-radius: 10px;
      color: #3399ff;
      opacity: 1;
    }

    #sortable {
      width: 100%;
      visibility: visible;
      position: absolute;
      top: 0;
      z-index: 10;
      background-color: #000;
      margin: 0;
      padding: 0;
    }

    .newDiv {
      width: 200px;
      height: 200px;
      background-repeat: no-repeat;
      background-color: #000;
      background-position: center;
      background-size: contain;
      float: left;
      margin: 1px;
      box-shadow: 0px 0px 1px #39f;
    }

    #menu {
      visibility: visible;
      z-index: 100;
      position: fixed;
      top: 0;
      background: rgba(0, 0, 0, 0.6);
      width: 100%;
      height: 64px;
    }

    .menuMain {
      display: inline;
      float: left;
    }

    .menuPic {
      display: none;
      float: left;
    }

    #delayCountWrap {
      float: left;
    }

    .delayCount {
      float: left;
      height: 32px;
      border: 1px solid #39f;
      border-radius: 3px;
      margin: 1px;
    }

    #delayCountLabel {
      text-align: center;
      height: 24px;
      font-size: 1.25em;
      border: 1px solid #39f;
      border-radius: 3px;
      margin: 1px;
    }

    #delayCountTxt {
      text-align: center;
      height: 26px;
      font-size: 1.25em;
    }

    #full {
      float: right;
    }

    input[type="number"] {
      -webkit-appearance: textfield;
      -moz-appearance: textfield;
      appearance: textfield;
    }

    input[type=number]::-webkit-inner-spin-button,
    input[type=number]::-webkit-outer-spin-button {
      -webkit-appearance: none;
    }
  </style>
</head>

<body>
  <div id="menu">
    <img id="play" class="menuMain playClass" title="play" src="icons/icons-play.png" />
    <img id="stop" class="menuMain" title="stop" src="icons/stop.png" />
    <img id="zoomIn" class="menuPic" title="zoom in" src="icons/icons-zoom-in.png" />
    <img id="zoomNormal" class="menuPic" title="zoom normal" src="icons/icons-zoom-normal.png" />
    <img id="zoomOut" class="menuPic" title="zoom out" src="icons/icons-zoom-out.png" />
    <img id="prevPic" class="menuPic" title="prev pic" src="icons/icons-prev.png" />
    <img id="nextPic" class="menuPic" title="next pic" src="icons/icons-next.png" />
    <div id="delayCountWrap" class="menuPic">
      <div id="delayCountLabel">
        <font>Delay(sec)</font>
      </div>
      <div id="delayCount">
        <div class="delayCount"><img id="addCount" src="icons/icons-add.png" /></div>
        <div class="delayCount"><input id="delayCountTxt" type="number" min="1" max="60000" name="counter" size="4" value="3" /></div>
        <div class="delayCount"><img id="minusCount" src="icons/icons-minus.png" /></div>
      </div>
    </div>
    <img id="full" title="fullscreen" src="icons/icons-fullscreen.png" />
  </div>
  <div id="sortable">
  </div>

</body>

</html>
